<div class="p-4">
  <!-- Loading State -->
  @if (deploymentsQuery.isPending()) {
    <p-table [value]="[1, 2, 3, 4, 5]" styleClass="p-datatable-lg">
      <ng-template pTemplate="header">
        <tr>
          <th>Name</th>
          <th>Commit SHA</th>
          <th>State</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body">
        <tr>
          <td><p-skeleton width="10rem"></p-skeleton></td>
          <td><p-skeleton width="5rem"></p-skeleton></td>
          <td><p-skeleton width="10rem"></p-skeleton></td>
        </tr>
      </ng-template>
    </p-table>
  } @else if (deploymentsQuery.data()?.length === 0) {
    <!-- Empty State -->
    <div class="text-gray-500">No deployments found.</div>
  } @else {
    <!-- Data Table -->
    <p-table [value]="deployments() || []" styleClass="p-datatable-sm">
      <ng-template pTemplate="header">
        <tr>
          <th>Name</th>
          <th>Commit SHA</th>
          <th>State</th>
          <th>Deployed On</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-deployment>
        <tr>
          <td>
            <div class="flex align-items-center gap-2">
              <i-tabler name="git-branch"></i-tabler>
              <span>{{ deployment.ref }}</span>
            </div>
          </td>
          <td>
            <div class="flex align-items-center gap-2">
              <i-tabler name="git-commit"></i-tabler>
              <span>{{ deployment.sha?.slice(0, 7) }}</span>
            </div>
          </td>
          <td>
            <div class="flex align-items-center gap-2">
              <span>{{ deployment.state }}</span>
            </div>
          </td>
          <td>
            <span>{{ dateService.formatDate(deployment.updatedAt, 'd MMMM y, h:mm a') }}</span>
          </td>
        </tr>
      </ng-template>
    </p-table>
  }
  <!-- Data Table -->
  <p-table [value]="combinedHistory() || []" styleClass="p-datatable-sm">
    <ng-template pTemplate="header">
      <tr>
        <th>Type</th>
        <th>Description</th>
        <th>Timestamp</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-combinedHistory>
      <tr>
        <td>
          <div class="flex align-items-center gap-2">
            <i-tabler name="type"></i-tabler>
            <span>{{ combinedHistory.type }}</span>
          </div>
        </td>
        <td>
          @if (combinedHistory.type == 'DEPLOYMENT') {
            <div class="flex align-items-center gap-2">
              <i-tabler name="deployment-info"></i-tabler>
              <span>Deployment ({{ combinedHistory.state }}) on branch {{ combinedHistory.ref }} ({{ combinedHistory.sha }})</span>
            </div>
          } @else if (combinedHistory.type == 'LOCK_EVENT') {
            <div class="flex align-items-center gap-2">
              <i-tabler name="deployment-info"></i-tabler>
              <span>Locked By ({{ combinedHistory.lockedBy }}) and lockedAt {{ combinedHistory.lockedAt }}</span>
            </div>
          } @else if (combinedHistory.type == 'UNLOCK_EVENT') {
            <div class="flex align-items-center gap-2">
              <i-tabler name="deployment-info"></i-tabler>
              <span>Unlocked By ({{ combinedHistory.unlockedBy }}) and unlockedAt {{ combinedHistory.unlockedAt }}</span>
            </div>
          }
        </td>
        <td>
          <div class="flex align-items-center gap-2">
            <span>{{ combinedHistory.timestamp }}</span>
          </div>
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>
